@(username : String , welcomeText: (String,List[String]))
@main(Some(username)) {

<div class="page-header">
    <h1>Battle Room<small>You are battling as @username</small></h1>
</div>

<div id="onError" class="alert-message error">
    <p>
        <strong>Oops!</strong> <span></span>
    </p>
</div>


    <canvas id="canvas" width="850" height="500">
        <p>
            SERIOUSLY INTERNET EXPLORER?!?!?!?!?!?!?!?
            Come on! download a real browser that has the canvas element,
            Like Firefox ,Safari, or Chrome.
            Peace Out Brothaaaaaa

        </p>
    </canvas>

    <div id="onChat" class="row">

        <textarea id="talk" ></textarea>
        <div class="span10" id="messageGroup">
            <div id="messages">
                <div class="message"><span>BattleLord</span><p>@(welcomeText._1)</p></div>
            </div>
        </div>
        <div id="memberGroup" class="span4">
            <h2>Members</h2>
            <ul id="members">
                @welcomeText._2.map { user =>
                <li>@user</li>
                }
            </ul>
        </div>
    </div>



<script type="text/javascript" charset="utf-8">


    $(function() {
    var WS = window['MozWebSocket'] ? MozWebSocket : WebSocket

    var chatSocket = new WS("ws://localhost:9000@routes.Application.connect(username)");

    new Main().init(chatSocket);

    var sendMessage = function() {
                 chatSocket.send(JSON.stringify(
                    {text: $("#talk").val(),
                     cordx: -1,
                     cordy: -1 }
                   ));
                 $("#talk").val('');
                 }

    var receiveEvent = function(event) {
    var data = JSON.parse(event.data);
    // Handle errors
  if(data.error) {
    chatSocket.close()
    $("#onError span").text(data.error)
    $("#onError").show()
    }

    // Create the message element
    var el = $('<div class="message"><span></span><p></p></div>');
    if(data.user) {
    $("span", el).text(data.user);
    }else{
    $("span", el).text("BattleLord");
    }
    $("p", el).text(data.message);
    $(el).addClass(data);
    if(data.user == '@username') $(el).addClass('me')
    $('#messages').append(el)

    // Update the members list
    if(data.members){
                 $("#members").html('')
                 $(data.members).each(function() {
                            $("#members").append('<li>' + this + '</li>')
                                                })
                    }

    if(data.shotResult){
            var shotResult = data.shotResult;
            var posx = data.shotpos.posx;
            var posy = data.shotpos.posy;
            g_ApplicationManager.level.paintShot(shotResult,posx,posy,data.gettingShot);
                        }
    if(data.finishedGame){
    g_ApplicationManager.openMainMenu();

    }


    }


    var handleReturnKey = function(e) {
    if(e.charCode == 13 || e.keyCode == 13) {
    e.preventDefault();
    sendMessage();
    }
    }

    $("#talk").keypress(handleReturnKey)

    chatSocket.onmessage = receiveEvent;

    })

</script>
<script src="@routes.Assets.at("javascripts/GameObject.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("javascripts/ResourceManager.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("javascripts/GameObjectManager.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("javascripts/ApplicationManager.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("javascripts/Level.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("javascripts/VisualGameObject.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("javascripts/MainMenu.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("javascripts/AnimatedGameObject.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("javascripts/Main.js")" type="text/javascript"></script>
<!--<script src="@routes.Assets.at("javascripts/prototype-1.6.0.3.js")" type="text/javascript"></script>-->
<script src="@routes.Assets.at("javascripts/Utils.js")" type="text/javascript"></script>


}
